<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Certificate Generator — Fixed (JUTECHS logo)</title>
    <style>
        :root {
            --bg: #f4f9ff;
            --card: #fff;
            --accent: #0a63b7;
            --muted: #5b6b7a;
            --paper: #fffdf9;
        }

        body {
            font-family: Inter, system-ui, Segoe UI, Roboto, Arial;
            margin: 0;
            padding: 18px;
            background: linear-gradient(180deg, #eef6ff, #f7fbff);
            color: #062a4a;
        }

        .wrap {
            max-width: 1100px;
            margin: 0 auto;
            display: grid;
            grid-template-columns: 420px 1fr;
            gap: 18px;
            align-items: start;
        }

        header {
            grid-column: 1/-1;
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 12px;
            margin-bottom: 6px;
        }

        header h1 {
            margin: 0;
            color: var(--accent);
            font-size: 18px;
        }

        .card {
            background: var(--card);
            padding: 14px;
            border-radius: 12px;
            box-shadow: 0 8px 26px rgba(10, 80, 160, 0.06);
            border: 1px solid rgba(10, 80, 160, 0.04);
        }

        label {
            font-size: 13px;
            color: var(--muted);
            display: block;
            margin-bottom: 6px;
        }

        input[type="text"],
        input[type="date"],
        textarea {
            width: 100%;
            padding: 10px 12px;
            border-radius: 8px;
            border: 1px solid #e6eefc;
            background: #fbfdff;
        }

        textarea {
            min-height: 72px;
            resize: vertical;
        }

        .row {
            display: flex;
            gap: 10px;
        }

        .row .col {
            flex: 1;
        }

        button {
            background: var(--accent);
            color: white;
            padding: 10px 12px;
            border-radius: 8px;
            border: 0;
            cursor: pointer;
            font-weight: 700;
        }

        button.secondary {
            background: transparent;
            border: 1px solid var(--accent);
            color: var(--accent);
            font-weight: 700;
        }

        .previewWrap {
            padding: 16px;
            background: linear-gradient(180deg, #fbfdff, #f6fbff);
            border-radius: 12px;
            display: flex;
            justify-content: center;
        }

        .certificate {
            width: 792px;
            height: 560px;
            padding: 28px 34px;
            background: linear-gradient(180deg, var(--paper), #ffffff);
            border: 8px solid #f0f6ff;
            border-radius: 6px;
            box-sizing: border-box;
            font-family: Georgia, serif;
            position: relative;
            color: #092a4a;
        }

        .cert-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .org {
            display: flex;
            gap: 12px;
            align-items: center;
        }

        .logo {
            width: 76px;
            height: 76px;
            border-radius: 8px;
            overflow: hidden;
            background: linear-gradient(90deg, #e6f2ff, #fff);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 800;
            color: var(--accent);
            font-size: 18px;
        }

        .cert-title {
            text-align: center;
            margin-top: 18px;
        }

        .cert-title h2 {
            margin: 0;
            font-size: 22px;
            color: var(--accent);
        }

        .cert-body {
            display: flex;
            gap: 18px;
            margin-top: 18px;
            align-items: flex-start;
        }

        .cert-left {
            flex: 1.2;
        }

        .recipient {
            font-size: 18px;
            font-weight: 800;
            color: #07294a;
        }

        .cert-right {
            width: 210px;
            display: flex;
            flex-direction: column;
            gap: 10px;
            align-items: center;
        }

        .photo {
            width: 120px;
            height: 120px;
            border-radius: 8px;
            border: 2px solid #eef6ff;
            background: #fbfdff;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
        }

        .photo img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            display: block;
        }

        .signature-box {
            width: 160px;
            height: 60px;
            border-top: 1px solid #d9e8ff;
            display: flex;
            align-items: flex-end;
            justify-content: center;
            font-size: 12px;
            color: var(--muted);
        }

        .serial {
            position: absolute;
            right: 26px;
            bottom: 18px;
            font-size: 11px;
            color: var(--muted);
        }

        .sig-wrap {
            display: flex;
            gap: 8px;
            align-items: center;
            margin-top: 6px;
        }

        canvas#sigCanvas {
            border: 1px dashed #dbeeff;
            width: 100%;
            height: 84px;
            border-radius: 6px;
            touch-action: none;
        }

        @media(max-width:1100px) {
            .wrap {
                grid-template-columns: 1fr;
            }

            .certificate {
                width: 680px;
                height: 480px;
            }
        }
    </style>
</head>

<body>
    <div class="wrap">
        <header>
            <div>
                <h1>Certificate Generator — Full-Stack Developer</h1>
                <div style="color:var(--muted);font-size:13px">Fill the form, upload <strong>JUTECHS.JPG</strong> as
                    Logo if you have it, then Generate PDF</div>
            </div>
            <div style="text-align:right">
                <div style="font-weight:800;color:var(--accent)">Jutechs Academy</div>
                <div style="color:var(--muted);font-size:13px">PDF will include preview values and uploaded logo</div>
            </div>
        </header>

        <!-- FORM -->
        <div class="card">
            <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:10px">
                <div>
                    <div style="font-size:13px;color:var(--muted)">Issuer</div>
                    <div style="font-weight:800;color:var(--accent)">Jutechs Academy</div>
                </div>
                <div style="font-size:13px;color:var(--muted)">Template: Full-Stack Developer</div>
            </div>

            <label>Upload Academy Logo (choose your JUTECHS.JPG)</label>
            <input id="logoInput" type="file" accept="image/*" />

            <div style="height:8px"></div>

            <label>Recipient Full Name</label>
            <input id="name" type="text" placeholder="Jane A. Doe" />

            <div class="row" style="margin-top:8px">
                <div class="col">
                    <label>Completion Date</label>
                    <input id="date" type="date" />
                </div>
                <div class="col">
                    <label>Certificate ID (optional)</label>
                    <input id="certId" type="text" placeholder="JTC-2025-0001" />
                </div>
            </div>

            <div style="margin-top:8px">
                <label>Course / Title</label>
                <input id="course" type="text" value="Full-Stack Web Development" />
            </div>

            <div class="row" style="margin-top:8px">
                <div class="col">
                    <label>Score / Grade</label>
                    <input id="score" type="text" placeholder="e.g., 92% / Distinction" />
                </div>
                <div class="col">
                    <label>Issuer (display)</label>
                    <input id="issuer" type="text" value="Jutechs Academy" />
                </div>
            </div>

            <div style="margin-top:8px">
                <label>Remarks</label>
                <textarea id="remarks">Completed an intensive program covering HTML, CSS, JavaScript, React, Node.js, and Databases.</textarea>
            </div>

            <div style="margin-top:8px">
                <label>Upload Photo (optional)</label>
                <input id="photoInput" type="file" accept="image/*" />
            </div>

            <div style="margin-top:10px">
                <label>Signature (draw or upload)</label>
                <div class="sig-wrap">
                    <div style="flex:1">
                        <canvas id="sigCanvas"></canvas>
                        <div style="display:flex;gap:8px;margin-top:6px">
                            <button id="clearSig" class="secondary">Clear</button>
                            <label style="display:inline-block">
                <input id="sigUpload" type="file" accept="image/*" style="display:none" />
                <button class="secondary" id="sigUploadBtn">Upload</button>
              </label>
                        </div>
                    </div>
                    <div style="width:120px;text-align:center">
                        <div style="font-size:13px;color:var(--muted)">Signature Preview</div>
                        <div id="sigPreview"
                            style="width:110px;height:70px;border:1px dashed #e6f3ff;border-radius:6px;margin-top:8px;display:flex;align-items:center;justify-content:center;background:#fbfdff;overflow:hidden">
                            <span style="color:var(--muted);font-size:13px">None</span>
                        </div>
                    </div>
                </div>
            </div>

            <div style="margin-top:12px;display:flex;gap:8px">
                <button id="generateBtn">Generate PDF & Download</button>
                <button id="updateBtn" class="secondary">Update Preview</button>
                <button id="resetBtn" class="secondary">Reset</button>
            </div>
            <div style="margin-top:10px;color:var(--muted);font-size:13px">Note: If you want the academy logo to be
                exactly <strong>JUTECHS.JPG</strong>, upload that file via "Upload Academy Logo".</div>
        </div>

        <!-- PREVIEW -->
        <div class="card previewWrap">
            <div id="certificate" class="certificate" role="document" aria-label="Certificate preview">
                <div class="cert-header">
                    <div class="org">
                        <div class="logo"><img id="logoImg" alt="logo" style="width:100%;height:100%;object-fit:cover;display:block" />
                        </div>
                        <div>
                            <div id="orgTitle" style="font-weight:800;color:var(--accent)">Jutechs Academy</div>
                            <div style="font-size:12px;color:var(--muted)">Certificate of Achievement</div>
                        </div>
                    </div>
                    <div style="text-align:right">
                        <div style="font-size:12px;color:var(--muted)">Accredited</div>
                        <div style="font-weight:800;color:var(--accent)">Jutechs Institute</div>
                    </div>
                </div>

                <div class="cert-title">
                    <h2>Certificate of Completion</h2>
                    <div style="font-size:13px;color:var(--muted)">This certifies that the named individual has
                        successfully completed the program below</div>
                </div>

                <div class="cert-body">
                    <div class="cert-left">
                        <div class="recipient" id="previewName">Recipient Name</div>
                        <div style="margin-top:8px;font-weight:700;color:var(--accent)" id="previewCourse">Full-Stack
                            Web Development</div>
                        <div style="margin-top:8px;color:var(--muted)" id="previewRemarks">Completed training covering
                            front-end and back-end development, deployment and best practices.</div>

                        <div style="display:flex;gap:18px;margin-top:20px">
                            <div>
                                <div style="font-size:12px;color:var(--muted)">Date</div>
                                <div id="previewDate" style="font-weight:700">2025-01-01</div>
                            </div>
                            <div>
                                <div style="font-size:12px;color:var(--muted)">Score</div>
                                <div id="previewScore" style="font-weight:700">—</div>
                            </div>
                        </div>
                    </div>

                    <div class="cert-right">
                        <div class="photo" id="previewPhoto">
                            <span style="color:var(--muted);font-size:13px">Photo</span>
                        </div>
                        <div style="width:100%;text-align:center;margin-top:6px">
                            <div class="signature-box" id="previewSignature">Signature</div>
                            <div style="margin-top:6px;font-size:13px;color:var(--muted)" id="previewIssuer">Jutechs
                                Academy</div>
                        </div>
                    </div>
                </div>

                <div class="serial" id="previewSerial">Serial: —</div>
            </div>
        </div>
    </div>

    <!-- html2pdf -->
    <script src="https://unpkg.com/html2pdf.js@0.10.1/dist/html2pdf.bundle.min.js"></script>

    <script>
        // --- Setup canvas for signature
  const sigCanvas = document.getElementById('sigCanvas');
  function setupCanvas(){
    const ratio = Math.max(window.devicePixelRatio || 1, 1);
    const w = sigCanvas.clientWidth;
    const h = 84; // fixed visual height
    sigCanvas.width = Math.floor(w * ratio);
    sigCanvas.height = Math.floor(h * ratio);
    sigCanvas.style.width = w + 'px';
    sigCanvas.style.height = h + 'px';
    const ctx = sigCanvas.getContext('2d');
    ctx.scale(ratio, ratio);
    ctx.lineWidth = 2.0;
    ctx.lineCap = 'round';
    ctx.strokeStyle = '#07294a';
    clearSig();
  }
  function clearSig(){
    const ctx = sigCanvas.getContext('2d');
    ctx.clearRect(0,0,sigCanvas.width,sigCanvas.height);
    setSigPreview(null);
  }
  let drawing=false, lastX=0,lastY=0;
  function pDown(e){ drawing=true; const rect=sigCanvas.getBoundingClientRect(); const x=(e.touches?e.touches[0].clientX:e.clientX)-rect.left; const y=(e.touches?e.touches[0].clientY:e.clientY)-rect.top; lastX=x; lastY=y; }
  function pMove(e){ if(!drawing) return; const rect=sigCanvas.getBoundingClientRect(); const x=(e.touches?e.touches[0].clientX:e.clientX)-rect.left; const y=(e.touches?e.touches[0].clientY:e.clientY)-rect.top; const ctx=sigCanvas.getContext('2d'); ctx.beginPath(); ctx.moveTo(lastX,lastY); ctx.lineTo(x,y); ctx.stroke(); lastX=x; lastY=y; }
  function pUp(){ if(!drawing) return; drawing=false; const dataUrl = sigCanvas.toDataURL('image/png'); setSigPreview(dataUrl); }
  sigCanvas.addEventListener('pointerdown', pDown);
  sigCanvas.addEventListener('pointermove', pMove);
  window.addEventListener('pointerup', pUp);
  sigCanvas.addEventListener('touchstart', pDown, {passive:true});
  sigCanvas.addEventListener('touchmove', pMove, {passive:true});
  sigCanvas.addEventListener('touchend', pUp);

  // DOM refs
  const logoInput = document.getElementById('logoInput');
  const logoImg = document.getElementById('logoImg');
  const photoInput = document.getElementById('photoInput');
  const previewPhoto = document.getElementById('previewPhoto');
  const sigUpload = document.getElementById('sigUpload');
  const sigUploadBtn = document.getElementById('sigUploadBtn');

  const nameInput = document.getElementById('name'), dateInput=document.getElementById('date'),
        certIdInput=document.getElementById('certId'), courseInput=document.getElementById('course'),
        issuerInput=document.getElementById('issuer'), remarksInput=document.getElementById('remarks'),
        scoreInput=document.getElementById('score');

  const previewName = document.getElementById('previewName'), previewCourse=document.getElementById('previewCourse'),
        previewRemarks=document.getElementById('previewRemarks'), previewDate=document.getElementById('previewDate'),
        previewScore=document.getElementById('previewScore'), previewIssuer=document.getElementById('previewIssuer'),
        previewSignature=document.getElementById('previewSignature'), previewSerial=document.getElementById('previewSerial'),
        orgTitle=document.getElementById('orgTitle');

  // default embedded "JUTECHS.JPG" style logo: an SVG data URL so even without upload there's a real logo
  const defaultLogoSvg = encodeURIComponent(`<svg xmlns='http://www.w3.org/2000/svg' width='200' height='200'><rect width='100%' height='100%' rx='16' fill='#e9f4ff'/><text x='50%' y='55%' dominant-baseline='middle' text-anchor='middle' font-family='Arial' font-weight='800' font-size='48' fill='#0a63b7'>J</text></svg>`);
  logoImg.src = 'data:image/svg+xml;utf8,' + defaultLogoSvg;

  // logo upload
  logoInput.addEventListener('change', (e) => {
    const f = e.target.files[0];
    if(!f) return;
    const reader = new FileReader();
    reader.onload = () => { logoImg.src = reader.result; };
    reader.readAsDataURL(f);
  });

  // photo upload
  photoInput.addEventListener('change', (e) => {
    const f = e.target.files[0]; if(!f) return;
    const reader = new FileReader();
    reader.onload = () => {
      previewPhoto.innerHTML = '';
      const img = document.createElement('img'); img.src = reader.result;
      previewPhoto.appendChild(img);
    };
    reader.readAsDataURL(f);
  });

  // signature upload via button
  sigUploadBtn.addEventListener('click', (ev) => { ev.preventDefault(); sigUpload.click(); });
  sigUpload.addEventListener('change', (ev) => {
    const f = ev.target.files[0]; if(!f) return;
    const reader = new FileReader();
    reader.onload = () => {
      // draw into canvas and preview
      const img = new Image();
      img.onload = () => {
        const ctx = sigCanvas.getContext('2d'); clearSig(); // scale draw
        const ratio = (window.devicePixelRatio||1);
        const drawW = sigCanvas.width/ratio, drawH = sigCanvas.height/ratio;
        // fit
        const sx=0, sy=0, sw=img.width, sh=img.height;
        ctx.drawImage(img, 0, 0, drawW, drawH);
        const data = sigCanvas.toDataURL('image/png'); setSigPreview(data);
      };
      img.src = reader.result;
    };
    reader.readAsDataURL(f);
  });

  document.getElementById('clearSig').addEventListener('click', clearSig);

  function setSigPreview(dataUrl){
    const el = document.getElementById('sigPreview');
    el.innerHTML = '';
    if(!dataUrl){
      el.innerHTML = '<span style="color:var(--muted);font-size:13px">None</span>';
      previewSignature.innerHTML = 'Signature';
      return;
    }
    const img = document.createElement('img'); img.src = dataUrl; img.style.maxWidth='100%'; img.style.maxHeight='100%';
    el.appendChild(img);
    previewSignature.innerHTML = '<img src="'+dataUrl+'" style="width:140px;height:60px;object-fit:contain;display:block" alt="signature"/>';
  }

  // update preview values
  function updatePreview(){
    previewName.textContent = nameInput.value.trim() || 'Recipient Name';
    previewCourse.textContent = courseInput.value.trim() || 'Full-Stack Web Development';
    previewRemarks.textContent = remarksInput.value.trim() || 'Completed training covering front-end and back-end development.';
    previewDate.textContent = dateInput.value || (new Date()).toISOString().split('T')[0];
    previewScore.textContent = scoreInput.value || '—';
    previewIssuer.textContent = issuerInput.value || 'Jutechs Academy';
    orgTitle.textContent = issuerInput.value || 'Jutechs Academy';
    // serial / cert id
    let c = certIdInput.value.trim();
    if(!c){
      const now = new Date();
      const s = `JTC-${now.getFullYear()}${String(now.getMonth()+1).padStart(2,'0')}${String(now.getDate()).padStart(2,'0')}-${String(Math.floor(Math.random()*9000)+1000)}`;
      c = s;
    }
    previewSerial.textContent = 'Serial: ' + c;
  }

  // utility: wait until all images within an element are loaded
  function waitForImages(rootEl, timeoutMs = 3000){
    const imgs = Array.from(rootEl.querySelectorAll('img'));
    const promises = imgs.map(img => new Promise((res) => {
      if(img.complete && img.naturalWidth !== 0) return res();
      const onLoad = () => { cleanup(); res(); };
      const onErr = () => { cleanup(); res(); };
      const cleanup = () => { img.removeEventListener('load', onLoad); img.removeEventListener('error', onErr); };
      img.addEventListener('load', onLoad);
      img.addEventListener('error', onErr);
    }));
    // also include canvas as image (signature)
    const canvases = Array.from(rootEl.querySelectorAll('canvas'));
    canvases.forEach(c => {
      // nothing special; just ensure draw operations done — give microtask tick
      promises.push(new Promise(res => setTimeout(res, 10)));
    });
    // global timeout fallback
    return Promise.race([ Promise.all(promises), new Promise(res => setTimeout(res, timeoutMs)) ]);
  }

  // clone node and ensure images load before printing
  async function generatePDF(){
    // validation
    if(!nameInput.value.trim()){ alert('Please enter recipient name'); nameInput.focus(); return; }
    updatePreview();

    // clone certificate element to avoid style shifts and to ensure measured rendering
    const orig = document.getElementById('certificate');
    const clone = orig.cloneNode(true);
    // create wrapper that matches document background to avoid transparency issues
    const wrapper = document.createElement('div'); wrapper.style.padding = '16px'; wrapper.style.background = '#f7fbff';
    wrapper.appendChild(clone);
    document.body.appendChild(wrapper);
    // wait a tick to allow images created by cloning to start loading
    await new Promise(r => requestAnimationFrame(r));
    // Wait until images inside clone have loaded (logo, photo, signature)
    await waitForImages(clone, 4000);

    // html2pdf options
    const opt = {
      margin: 1,
      filename: `${(nameInput.value || 'certificate').replace(/[^a-z0-9_\- ]/gi,'')}_certificate.pdf`,
      image: { type: 'jpeg', quality: 0.98 },
      html2canvas: { scale: 2, useCORS: true, allowTaint: true, logging: false },
      jsPDF: { unit: 'mm', format: 'a4', orientation: 'protrait' }
    };

    try {
      await html2pdf().set(opt).from(clone).save();
    } catch(err){
      console.error('PDF error', err);
      alert('PDF generation failed — try again in a desktop browser.');
    } finally {
      // clean up clone
      document.body.removeChild(wrapper);
    }
  }

  // attach events
  document.getElementById('generateBtn').addEventListener('click', generatePDF);
  document.getElementById('updateBtn').addEventListener('click', updatePreview);
  document.getElementById('resetBtn').addEventListener('click', () => {
    if(!confirm('Reset all fields?')) return;
    nameInput.value=''; dateInput.value=''; certIdInput.value=''; courseInput.value='Full-Stack Web Development';
    issuerInput.value='Jutechs Academy'; remarksInput.value='Completed an intensive program covering HTML, CSS, JS, React, Node.js, and Databases.'; scoreInput.value='';
    previewPhoto.innerHTML = '<span style="color:var(--muted);font-size:13px">Photo</span>';
    logoImg.src = 'data:image/svg+xml;utf8,' + defaultLogoSvg;
    clearSig();
    updatePreview();
  });

  // initial setup
  window.addEventListener('load', () => { setupCanvas(); updatePreview(); });
  window.addEventListener('resize', () => { setupCanvas(); });

  // helper: small delay so preview stays current while user types
  [nameInput, dateInput, certIdInput, courseInput, issuerInput, remarksInput, scoreInput].forEach(inp => {
    inp.addEventListener('input', () => { clearTimeout(window.__pp); window.__pp = setTimeout(updatePreview, 150); });
  });
    </script>
</body>

</html>
