<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Jutechs — Professional Certificate Generator</title>

  <!-- External libs (CDN) -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js" integrity="sha512-BNa5Qf0tq8QRyqZ0s9p3rJv2QnPO8gWl6e6kz1kgmB6tq6H3x1h2f3e2v/2x8g7QH9xQ2f4ZQn4y5Rx3x5Qf0g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js" integrity="sha512-5l2yV3bY4bZs9cK0yW3oA6gN7c5vZj8w3d6mX3m9kZl8k2A7R1fE3Y4bH2t1p3yQ9h4Vg7Y2z3Jm1w2Qm7Q2A==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
  <script src="https://cdn.jsdelivr.net/npm/signature_pad@4.0.0/dist/signature_pad.umd.min.js"></script>

  <style>
    :root{
      --bg:#f3f7fb; --card:#ffffff; --accent:#0a63b7; --muted:#556;
      --paper:#fdfdfd;
    }
    body{ font-family: Inter, ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial; margin:0; padding:20px; background:linear-gradient(180deg,#f7fbff,var(--bg)); color:#0b2540; }
    .container{ max-width:1100px; margin:0 auto; display:grid; grid-template-columns: 420px 1fr; gap:20px; align-items:start; }
    h1{ margin:0 0 8px 0; font-size:20px; color:var(--accent); }
    .card{ background:var(--card); border-radius:12px; padding:16px; box-shadow:0 8px 30px rgba(10,40,80,0.06); border:1px solid rgba(10,40,80,0.04); }
    label{ font-size:13px; color:var(--muted); display:block; margin-bottom:6px; }
    input[type="text"], input[type="date"], select, textarea{ width:100%; padding:10px 12px; border-radius:8px; border:1px solid #e6eefc; background:#fbfdff; font-size:14px; box-sizing:border-box; }
    .row{ display:flex; gap:10px; }
    .small{ font-size:12px; color:#556; }
    .btn{ background:var(--accent); color:white; padding:10px 14px; border-radius:8px; border:0; cursor:pointer; font-weight:700; }
    .btn.secondary{ background:transparent; color:var(--accent); border:1px solid #cfe3ff; font-weight:700; }
    .controls{ display:flex; gap:8px; margin-top:10px; flex-wrap:wrap; }
    .logo-preview{ width:120px; height:80px; object-fit:contain; background:linear-gradient(180deg,#fff,#f6faff); border-radius:6px; padding:6px; display:block; border:1px solid #eef6ff; }
    .signature-pad{ border:1px dashed #dbefff; border-radius:8px; background:#fff; width:100%; height:120px; touch-action: none; }
    .muted{ color:var(--muted); font-size:13px; }
    /* Certificate preview styles */
    .preview-wrap{ padding:24px; display:flex; justify-content:center; }
    .certificate{
      width:842px; /* A4 at 96dpi approx for preview */
      height:595px;
      background: linear-gradient(180deg,#ffffff,#fcfdff);
      border:8px solid #f1f7ff;
      box-shadow: 0 10px 35px rgba(6,24,60,0.08);
      position:relative;
      padding:36px 48px;
      box-sizing:border-box;
      font-family: "Times New Roman", serif;
    }
    .cert-header{ display:flex; align-items:center; gap:18px; }
    .cert-logo{ width:120px; height:90px; object-fit:contain; border-radius:8px; background:#fff; padding:6px; border:1px solid #eef6ff; }
    .cert-title{ flex:1; text-align:center; }
    .cert-title h2{ margin:0; font-size:28px; color:var(--accent); letter-spacing:1px; }
    .cert-title p{ margin:4px 0 0 0; color:#213b5a; font-weight:600; font-size:14px; }
    .cert-body{ margin-top:26px; text-align:center; }
    .recipient{ font-size:28px; font-weight:800; margin-top:12px; }
    .desc{ margin-top:12px; font-size:15px; color:#234; max-width:80%; margin-left:auto; margin-right:auto; line-height:1.4; }
    .meta-line{ margin-top:26px; display:flex; justify-content:space-between; align-items:center; padding:0 24px; }
    .meta-left{ text-align:left; font-size:13px; color:#234; }
    .meta-right{ text-align:right; font-size:13px; color:#234; }
    .signature-block{ margin-top:18px; display:flex; justify-content:space-between; align-items:flex-end; padding:0 24px; }
    .sign-box{ text-align:center; width:45%; }
    .sign-img{ max-width:220px; max-height:80px; display:block; margin:0 auto; }
    .cert-serial{ font-size:11px; color:#556; text-align:center; margin-top:8px; }
    .controls-compact{ display:flex; gap:6px; margin-top:10px; }
    .note{ font-size:12px; color:#456; margin-top:8px; }
    @media (max-width:980px){
      .container{ grid-template-columns:1fr; }
      .certificate{ width:100%; height:auto; transform:scale(0.85); transform-origin:top center; }
    }
  </style>
</head>
<body>
  <div class="container">
    <!-- Left: form -->
    <div class="card">
      <h1>Jutechs — Certificate Generator</h1>
      <p class="muted">Fill the fields below. Upload a logo or place a file named <code>jutechs.jpg</code> next to this HTML file. Draw or upload a signature. Click <strong>Generate PDF</strong> to download an A4 certificate.</p>

      <div style="margin-top:12px;">
        <label>Recipient Full Name</label>
        <input id="fullName" type="text" placeholder="e.g., Linah Tipira" />

        <label style="margin-top:10px;">ID / Registration Number</label>
        <input id="idNumber" type="text" placeholder="e.g., 12345678" />

        <label style="margin-top:10px;">Course / Title</label>
        <input id="course" type="text" placeholder="e.g., Full-Stack Web Development" />

        <div class="row" style="margin-top:10px;">
          <div style="flex:1;">
            <label>Date of Issue</label>
            <input id="issueDate" type="date" />
          </div>
          <div style="width:170px;">
            <label>Grade / Remark</label>
            <input id="grade" type="text" placeholder="e.g., Distinction" />
          </div>
        </div>

        <label style="margin-top:10px;">Issuer (Organization)</label>
        <input id="issuer" type="text" placeholder="Jutechs" value="Jutechs" />

        <label style="margin-top:10px;">Certificate ID (auto or edit)</label>
        <input id="certId" type="text" />

        <hr style="margin:14px 0;" />

        <label>Upload Logo (optional — PNG/JPG)</label>
        <input id="logoInput" type="file" accept="image/*" />

        <div style="display:flex; gap:10px; align-items:center; margin-top:8px;">
          <img id="logoPreview" class="logo-preview" src="" alt="logo preview" onerror="this.style.display='none'"/>
          <div>
            <div class="small">If you don't upload, the app will try to load <code>jutechs.jpg</code> from this folder.</div>
            <div class="note">Recommended: transparent PNG or 400×400 px.</div>
          </div>
        </div>

        <hr style="margin:14px 0;" />

        <label>Signature (draw)</label>
        <canvas id="sigCanvas" class="signature-pad"></canvas>
        <div class="controls-compact">
          <button id="clearSig" class="btn secondary">Clear</button>
          <button id="saveSig" class="btn secondary">Use as Signature</button>
          <div class="small" style="align-self:center;">or upload an image:</div>
          <input id="sigUpload" type="file" accept="image/*" />
        </div>

        <div class="controls" style="margin-top:14px;">
          <button id="generatePdf" class="btn">Generate PDF</button>
          <button id="previewBtn" class="btn secondary">Refresh Preview</button>
          <button id="downloadPng" class="btn secondary">Download Certificate PNG</button>
        </div>

        <div class="note" style="margin-top:10px;">PDF is generated client-side and will download directly to your device storage (check browser Downloads folder or prompt depending on device).</div>
      </div>
    </div>

    <!-- Right: preview -->
    <div class="card">
      <h1 style="font-size:16px;margin-bottom:8px;">Preview — A4 Certificate</h1>
      <div class="preview-wrap" id="previewWrap">
        <div class="certificate" id="certificate">
          <div class="cert-header">
            <img id="certLogo" class="cert-logo" src="" alt="logo" />
            <div class="cert-title">
              <h2>Certificate of Completion</h2>
              <p>Presented by <strong id="issuerPreview">Jutechs</strong></p>
            </div>
            <div style="width:120px"></div>
          </div>

          <div class="cert-body">
            <div style="font-size:14px;color:#334; margin-top:6px;">This is to certify that</div>
            <div id="recipientPreview" class="recipient">[Recipient Name]</div>
            <div class="desc" id="descPreview">has successfully completed the requirements of the course and demonstrated competency in the subject matter for the course mentioned below.</div>

            <div style="margin-top:18px;font-weight:700;color:#234;">Course / Title</div>
            <div style="font-weight:600;font-size:15px;margin-top:6px;" id="coursePreview">[Course]</div>

            <div class="meta-line">
              <div class="meta-left">
                <div><strong>ID:</strong> <span id="idPreview">—</span></div>
                <div style="margin-top:6px;"><strong>Date:</strong> <span id="datePreview">—</span></div>
              </div>
              <div class="meta-right">
                <div><strong>Grade:</strong> <span id="gradePreview">—</span></div>
                <div style="margin-top:6px;"><strong>Certificate No:</strong> <span id="certIdPreview">—</span></div>
              </div>
            </div>

            <div class="signature-block">
              <div class="sign-box">
                <div style="height:90px; display:flex; align-items:center; justify-content:center;">
                  <img id="sigPreview" class="sign-img" src="" alt="signature" style="display:none" />
                </div>
                <div style="margin-top:6px; font-size:13px; color:#243;">Signature</div>
              </div>

              <div style="width:200px; text-align:center;">
                <div style="font-size:13px;color:#556;">Authorized by</div>
                <div style="font-weight:700; margin-top:6px;" id="issuerSign">Jutechs</div>
                <div class="cert-serial" id="issuedSerial">Serial: —</div>
              </div>
            </div>

          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    /*************************************************************************
     * Certificate Generator - Single file frontend app
     * - Uses html2canvas + jsPDF to export a high-resolution A4 PDF
     * - SignaturePad for drawing signatures
     * - Logo upload fallback to 'jutechs.jpg' in same directory
     *
     * How it works:
     * 1. User fills fields and provides logo/signature.
     * 2. Preview updates in real-time or via "Refresh Preview".
     * 3. Generate PDF: html2canvas renders the preview at high scale, jsPDF
     *    creates an A4-sized PDF and downloads it to device storage.
     *************************************************************************/

    // Short helpers for DOM
    const $, $$;
    const el = id => document.getElementById(id);
    const fullName = el('fullName'), idNumber = el('idNumber'), course = el('course'),
          issueDate = el('issueDate'), grade = el('grade'), issuer = el('issuer'),
          certId = el('certId'), logoInput = el('logoInput'), logoPreview = el('logoPreview'),
          certLogo = el('certLogo'), recipientPreview = el('recipientPreview'),
          issuerPreview = el('issuerPreview'), coursePreview = el('coursePreview'),
          datePreview = el('datePreview'), gradePreview = el('gradePreview'),
          idPreview = el('idPreview'), certIdPreview = el('certIdPreview'),
          sigCanvas = el('sigCanvas'), clearSig = el('clearSig'), saveSig = el('saveSig'),
          sigUpload = el('sigUpload'), sigPreview = el('sigPreview'),
          previewBtn = el('previewBtn'), generatePdf = el('generatePdf'),
          downloadPng = el('downloadPng'), issuedSerial = el('issuedSerial'),
          cert = el('certificate'), certDesc = el('descPreview'), issuerSign = el('issuerSign');

    // SignaturePad setup
    const signaturePad = new SignaturePad(sigCanvas, { backgroundColor: 'rgba(255,255,255,0)', penColor: 'rgb(15,45,90)', minWidth:1, maxWidth:2.5 });

    // Make canvas fit container
    function resizeSigCanvas(){
      const ratio = Math.max(window.devicePixelRatio || 1, 1);
      const w = sigCanvas.clientWidth;
      const h = sigCanvas.clientHeight;
      sigCanvas.width = Math.floor(w * ratio);
      sigCanvas.height = Math.floor(h * ratio);
      sigCanvas.getContext('2d').scale(ratio, ratio);
      signaturePad.clear(); // keep cleared after resize to avoid stretching previous stroke
    }
    // Initial resize
    window.addEventListener('resize', resizeSigCanvas);
    resizeSigCanvas();

    // Auto-generate certificate ID if empty
    function generateSerial(){
      const d = new Date();
      const y = d.getFullYear().toString().slice(-2);
      const rand = Math.floor(100000 + Math.random() * 900000); // six-digit
      return `JUT-${y}-${rand}`;
    }
    if(!certId.value) certId.value = generateSerial();

    // Try to pre-load jutechs.jpg from same folder (if user kept it there)
    (function tryLoadLocalLogo(){
      const img = new Image();
      img.onload = () => {
        certLogo.src = 'jutechs.jpg';
        logoPreview.src = 'jutechs.jpg';
        logoPreview.style.display = '';
      };
      img.onerror = () => {
        // hide preview if not found
      };
      img.src = 'jutechs.jpg';
    })();

    // Update preview function
    function refreshPreview(){
      // Assign values (with fallbacks)
      const nameVal = fullName.value.trim() || '[Recipient Name]';
      const idVal = idNumber.value.trim() || '—';
      const courseVal = course.value.trim() || '[Course]';
      const dateVal = issueDate.value ? new Date(issueDate.value).toLocaleDateString() : new Date().toLocaleDateString();
      const gradeVal = grade.value.trim() || '—';
      const issuerVal = issuer.value.trim() || 'Jutechs';
      const certVal = certId.value.trim() || generateSerial();

      recipientPreview.textContent = nameVal;
      idPreview.textContent = idVal;
      coursePreview.textContent = courseVal;
      datePreview.textContent = dateVal;
      gradePreview.textContent = gradeVal;
      issuerPreview.textContent = issuerVal;
      issuerSign.textContent = issuerVal;
      certIdPreview.textContent = certVal;
      issuedSerial.textContent = 'Serial: ' + certVal;

      // Description: small sentence
      certDesc.textContent = `${nameVal} has successfully completed the ${courseVal} program and satisfied the required assessments for certification.`;

      // Logo: if user uploaded an image, it's already set; otherwise if certLogo src empty and we previously found jutechs.jpg the src remains
      // If no logo, hide image element
      if(!certLogo.src || certLogo.src === window.location.href){
        certLogo.style.display = 'none';
      } else {
        certLogo.style.display = '';
      }

      // Signature: if user saved/uploaded signature, display it
      if(sigPreview.src){
        sigPreview.style.display = '';
      } else {
        sigPreview.style.display = 'none';
      }
    }

    // Attach basic live handlers
    [fullName, idNumber, course, issueDate, grade, issuer, certId].forEach(inp => {
      inp.addEventListener('input', () => { refreshPreview(); });
    });

    // Logo upload handling
    logoInput.addEventListener('change', (ev) => {
      const file = ev.target.files[0];
      if(!file) return;
      const url = URL.createObjectURL(file);
      certLogo.src = url;
      logoPreview.src = url;
      logoPreview.style.display = '';
      certLogo.style.display = '';
      refreshPreview();
    });

    // Signature controls
    clearSig.addEventListener('click', () => {
      signaturePad.clear();
      // also clear preview signature
      sigPreview.src = '';
      sigPreview.style.display = 'none';
    });
    saveSig.addEventListener('click', () => {
      if(signaturePad.isEmpty()){
        alert('Please draw your signature first (or upload a signature image).');
        return;
      }
      const dataURL = signaturePad.toDataURL('image/png');
      sigPreview.src = dataURL;
      sigPreview.style.display = '';
    });
    sigUpload.addEventListener('change', (ev) => {
      const f = ev.target.files[0];
      if(!f) return;
      const url = URL.createObjectURL(f);
      sigPreview.src = url;
      sigPreview.style.display = '';
    });

    // Preview button
    previewBtn.addEventListener('click', () => {
      // If canvas has strokes but not saved, save automatically
      if(!sigPreview.src && !signaturePad.isEmpty()){
        sigPreview.src = signaturePad.toDataURL('image/png');
        sigPreview.style.display = '';
      }
      refreshPreview();
      // Smooth scroll to preview
      document.getElementById('previewWrap').scrollIntoView({behavior:'smooth'});
    });

    // Download PNG of the certificate (single image)
    downloadPng.addEventListener('click', async () => {
      await refreshPreview();
      // Render certificate element to canvas
      const scale = 2; // increase for higher res PNG
      const canvas = await html2canvas(cert, { scale, useCORS:true, allowTaint:true, backgroundColor:null });
      canvas.toBlob(blob => {
        const a = document.createElement('a');
        a.href = URL.createObjectURL(blob);
        a.download = (fullName.value.trim() || 'certificate') + '.png';
        a.click();
        URL.revokeObjectURL(a.href);
      }, 'image/png');
    });

    // Generate PDF
    generatePdf.addEventListener('click', async () => {
      // Ensure preview up to date and signature is saved
      if(!sigPreview.src && !signaturePad.isEmpty()){
        sigPreview.src = signaturePad.toDataURL('image/png');
        sigPreview.style.display = '';
      }
      refreshPreview();

      // Render at high DPI using html2canvas
      const a4 = { widthPt:595.28, heightPt:841.89 }; // points at 72dpi (jsPDF default)
      // We'll render at a pixel size relative to A4 at 2x scale to keep quality
      const scale = 2.6; // adjust for higher quality; large values => larger image & PDF size
      const canvas = await html2canvas(cert, { scale, useCORS:true, allowTaint:true, backgroundColor:'#ffffff' });

      // Convert to image data
      const imgData = canvas.toDataURL('image/png');

      // Create jsPDF (portrait A4)
      const { jsPDF } = window.jspdf;
      const pdf = new jsPDF({ unit:'pt', format:'a4', compress:true });

      // Calculate width/height to fit the A4 page while preserving aspect ratio
      const pageWidth = pdf.internal.pageSize.getWidth();
      const pageHeight = pdf.internal.pageSize.getHeight();

      // Canvas pixel size
      const imgW = canvas.width;
      const imgH = canvas.height;

      // Convert pixel dims to PDF points at 72dpi: px * 72 / (devicePixelRatio*96) but simpler to compute scale factor
      // We'll map canvas image to page width with maintained aspect ratio
      const ratio = Math.min(pageWidth / imgW, pageHeight / imgH);
      const renderW = imgW * ratio;
      const renderH = imgH * ratio;
      const marginX = (pageWidth - renderW) / 2;
      const marginY = (pageHeight - renderH) / 2;

      // Add image to PDF
      pdf.addImage(imgData, 'PNG', marginX, marginY, renderW, renderH, undefined, 'FAST');

      // Trigger download
      const filename = `${(fullName.value.trim() || 'certificate')}_certificate.pdf`;
      pdf.save(filename);
    });

    // Initial preview refresh
    refreshPreview();

  </script>
</body>
</html>
